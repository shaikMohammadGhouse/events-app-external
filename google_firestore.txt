In the Google Cloud Console, click Navigation Menu | Firestore
Click the Select Native Mode button
Select a location that matches where your other resources are running
Click the Create Database button
-----------------------------------
Access Firestore from Node.js

In Cloud Shell, navigate to the internal folder and install Firestore node module:
npm install --save @google-cloud/firestore
In the internal/server.js, require Firestore and initialize Firestore (near the top):

// bring in firestore
const Firestore = require("@google-cloud/firestore");

// initialize Firestore and set project id from env var
const firestore = new Firestore(
    {
        projectId: process.env.GOOGLE_CLOUD_PROJECT
    }
);

Keep the internal/server.js file open, and make the edits on the next slides 
-------------------------------------------------

app.post('/event', (req, res) => {
    // create a new object from the json data and add an id
    const ev = { 
        title: req.body.title, 
        description: req.body.description,
        id : mockEvents.events.length + 1
     }
// this will create the Events collection if it does not exist
    firestore.collection("Events").add(ev).then(ret => {
        getEvents(req, res);
    });

});

---------------------
app.post('/event', (req, res) => {
    // create a new object from the json data and add an id
    const ev = { 
        title: req.body.title, 
        description: req.body.description,
        id : mockEvents.events.length + 1
     }
// this will create the Events collection if it does not exist
    firestore.collection("Events").add(ev).then(ret => {
        getEvents(req, res);
    });

});

----------------------
function getEvents(req, res) {
    firestore.collection("Events").get()
        .then((snapshot) => {
            if (!snapshot.empty) {
                const ret = { events: []};
                snapshot.docs.forEach(element => {
                    ret.events.push(element.data());
                }, this);
                console.log(ret);
                res.json(ret);
            } else {
                 res.json(mockEvents);
            }
        })
        .catch((err) => {
            console.error('Error getting events', err);
            res.json(mockEvents);
        });
};


